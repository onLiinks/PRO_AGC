var MultiSelect={selectIds:[],observing:false,toggle:function(d,b,f){var a=$(d);if(a!=null){if(a.visible()||(typeof f!="undefined"&&f)){a.hide();MultiSelect.updateText(d)}else{var c=$(d+"TextDiv");var e=c.positionedOffset();a.setStyle({position:"absolute",top:e.top+c.getHeight()+1+"px",left:e.left+"px",height:b+"px"});a.show()}}},updateText:function(d){var a=$(d);var c="";for(i=0;i<a.options.length;i++){if(a.options[i].selected){var e=a.options[i].text;if(e.length>14){e=e.substring(0,5)+".."+e.substring(e.length-6,e.length)}if(c==""){c=e}else{c+=", "+e}}}var b=$(d+"TextDiv");b.innerHTML=c},makeDropdown:function(a,f){MultiSelect.cleanupSelects();var h=$(a);var j=[];for(var c=0;c<h.options.length;c++){var d={value:h.options[c].value,text:h.options[c].text,selected:h.options[c].selected};j.push(d)}var g=h.innerHTML;h.replace("<div id='"+a+"WrappingDiv' style='position:relative; width:205px'><nobr><div id='"+a+"TextDiv' style='padding:2px; background:#fff; position:absolute; left:0px; top:0px; border-left:1px solid #cbcbcb; border-top:1px solid #cbcbcb; border-bottom:1px solid #cbcbcb; overflow:hidden; width:180px; height:16px' onclick='MultiSelect.toggle(\""+a+'",'+f.height+")'></div><img src='"+f.arrowSrc+"' style='position:absolute; left:185px; top:0px; cursor:pointer; ' onclick='MultiSelect.toggle(\""+a+'",'+f.height+")'/></nobr><br/></div>");$(a+"WrappingDiv").appendChild(h);h.setStyle({minWidth:"203px",zIndex:"10"});h.hide();Event.observe(h,"change",function(){MultiSelect.updateText(a)});if(h.options.length==0){for(var c=0;c<j.length;c++){var b=Builder.node("option",{value:j[c].value,text:j[c].text,selected:j[c].selected});try{h.add(b,null)}catch(e){h.add(b)}}}MultiSelect.updateText(a);MultiSelect.addDocumentObserver(f.height);MultiSelect.selectIds.push(a)},cleanupSelects:function(){for(var b=0;b<MultiSelect.selectIds.length;b++){var a=MultiSelect.selectIds[b];if($(a)==null){MultiSelect.selectIds.splice(b,1);b=0}}},addDocumentObserver:function(a){if(!MultiSelect.observing){MultiSelect.observing=true;document.observe("click",function(d){var e=Event.findElement(d,"DIV");if(e!=null){for(var c=0;c<MultiSelect.selectIds.length;c++){var b=MultiSelect.selectIds[c];if(b+"WrappingDiv"!=e.id&&b+"TextDiv"!=e.id){MultiSelect.toggle(b,true,a)}}}else{for(var c=0;c<MultiSelect.selectIds.length;c++){var b=MultiSelect.selectIds[c];MultiSelect.toggle(b,true,a)}}})}}};